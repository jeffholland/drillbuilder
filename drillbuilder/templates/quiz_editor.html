{% extends 'base.html' %}

{% block content %}
<div class="card">
  <h2>Create Drill: <span id="quizTitle"></span></h2>
  <p>Add questions to your drill below.</p>

  <div id="questionsList"></div>

  <div class="card" style="margin-top:20px">
    <h3>Add New Question</h3>
    <label>Question Type:
      <select id="questionType">
        <option value="mcq">Multiple Choice (MCQ)</option>
        <option value="cloze">Fill-in-the-Blank (Cloze)</option>
        <option value="word_match">Word Matching</option>
      </select>
    </label>
    <button id="addQuestionBtn">Add Question</button>
  </div>
  <button id="saveQuizBtn" onclick="window.location='/dashboard'">Done</button>
  <button onclick="window.location='/take/' + quizId" style="margin-left:10px;">Run Drill</button>

  <!-- MCQ Editor -->
  <div id="mcqEditor" class="card" style="display:none;margin-top:20px">
    <h3>Multiple Choice Question</h3>
    <label>Question Text:<br/><textarea id="mcqPrompt" rows="3" style="width:100%"></textarea></label>
    <div class="image-upload-container" style="margin:10px 0;">
      <button type="button" class="image-upload-btn" onclick="triggerImageUpload('mcqQuestionImage')" style="font-size:12px;padding:4px 8px;">ðŸ“· Add Image</button>
      <input type="file" id="mcqQuestionImage" accept=".jpg,.jpeg" style="display:none;" onchange="handleImageUpload(this, 'mcqQuestionImagePreview', 'mcqQuestionImageUrl')" />
      <input type="hidden" id="mcqQuestionImageUrl" />
      <div id="mcqQuestionImagePreview" style="margin-top:5px;"></div>
    </div>
    <br/>
    <div id="mcqChoices">
      <div class="mcq-choice">
        <input type="text" placeholder="Choice 1" class="mcq-text" />
        <label><input type="checkbox" class="mcq-correct" /> Correct</label>
        <button type="button" class="choice-image-btn" onclick="triggerImageUpload(this.parentElement.querySelector('.choice-image-input'))" style="font-size:11px;padding:2px 6px;margin-left:8px;">ðŸ“·</button>
        <input type="file" class="choice-image-input" accept=".jpg,.jpeg" style="display:none;" onchange="handleChoiceImageUpload(this)" />
        <input type="hidden" class="choice-image-url" />
        <div class="choice-image-preview" style="display:inline-block;margin-left:5px;"></div>
      </div>
      <div class="mcq-choice">
        <input type="text" placeholder="Choice 2" class="mcq-text" />
        <label><input type="checkbox" class="mcq-correct" /> Correct</label>
        <button type="button" class="choice-image-btn" onclick="triggerImageUpload(this.parentElement.querySelector('.choice-image-input'))" style="font-size:11px;padding:2px 6px;margin-left:8px;">ðŸ“·</button>
        <input type="file" class="choice-image-input" accept=".jpg,.jpeg" style="display:none;" onchange="handleChoiceImageUpload(this)" />
        <input type="hidden" class="choice-image-url" />
        <div class="choice-image-preview" style="display:inline-block;margin-left:5px;"></div>
      </div>
    </div>
    <button id="addMcqChoice">Add Another Choice</button>
    <br/><br/>
    <button id="saveMcq">Save MCQ</button>
    <button id="cancelMcq">Cancel</button>
  </div>

  <!-- Cloze Editor -->
  <div id="clozeEditor" class="card" style="display:none;margin-top:20px">
    <h3>Fill-in-the-Blank (Cloze) Question</h3>
    <div id="clozeStep1">
      <label>Enter your sentence(s) (max 2000 chars):<br/>
        <textarea id="clozeText" rows="4" style="width:100%" maxlength="2000"></textarea>
      </label>
      <div class="image-upload-container" style="margin:10px 0;">
        <button type="button" class="image-upload-btn" onclick="triggerImageUpload('clozeQuestionImage')" style="font-size:12px;padding:4px 8px;">ðŸ“· Add Image</button>
        <input type="file" id="clozeQuestionImage" accept=".jpg,.jpeg" style="display:none;" onchange="handleImageUpload(this, 'clozeQuestionImagePreview', 'clozeQuestionImageUrl')" />
        <input type="hidden" id="clozeQuestionImageUrl" />
        <div id="clozeQuestionImagePreview" style="margin-top:5px;"></div>
      </div>
      <br/>
      <label style="display:block; margin:10px 0;">
        <input type="checkbox" id="clozeWordBank" /> Include word bank (show all blanks in random order)
      </label>
      <button id="clozeNext">Next: Select Blanks</button>
      <button id="cancelClozeStep1">Cancel</button>
    </div>
    <div id="clozeStep2" style="display:none">
      <p>Click on words to select them as blanks. Click "alt" to add alternate answers.</p>
      <div id="clozeWordSelect" style="line-height:2em; position:relative"></div>
      <br/>
      <button id="saveCloze">Save Cloze Question</button>
      <button id="cancelCloze">Cancel</button>
    </div>
  </div>

  <!-- Word Match Editor -->
  <div id="wordMatchEditor" class="card" style="display:none;margin-top:20px">
    <h3>Word Matching Question</h3>
    <p>Create pairs of words that match:</p>
    <div class="image-upload-container" style="margin:10px 0;">
      <button type="button" class="image-upload-btn" onclick="triggerImageUpload('wmQuestionImage')" style="font-size:12px;padding:4px 8px;">ðŸ“· Add Image</button>
      <input type="file" id="wmQuestionImage" accept=".jpg,.jpeg" style="display:none;" onchange="handleImageUpload(this, 'wmQuestionImagePreview', 'wmQuestionImageUrl')" />
      <input type="hidden" id="wmQuestionImageUrl" />
      <div id="wmQuestionImagePreview" style="margin-top:5px;"></div>
    </div>
    <div id="wordMatchPairs">
      <div class="word-match-pair">
        <input type="text" placeholder="Left word" class="wm-left" />
        <button type="button" onclick="triggerWMImageUpload(this, 'left')" style="font-size:11px;padding:2px 6px;margin:0 5px;">ðŸ“·</button>
        <span> â†’ </span>
        <input type="text" placeholder="Right word" class="wm-right" />
        <button type="button" onclick="triggerWMImageUpload(this, 'right')" style="font-size:11px;padding:2px 6px;margin:0 5px;">ðŸ“·</button>
        <input type="file" class="wm-left-image-input" accept=".jpg,.jpeg" style="display:none;" onchange="handleWMImageUpload(this, 'left')" />
        <input type="hidden" class="wm-left-image-url" />
        <input type="file" class="wm-right-image-input" accept=".jpg,.jpeg" style="display:none;" onchange="handleWMImageUpload(this, 'right')" />
        <input type="hidden" class="wm-right-image-url" />
        <div class="wm-left-preview" style="display:inline-block;margin-left:5px;"></div>
        <div class="wm-right-preview" style="display:inline-block;margin-left:5px;"></div>
      </div>
    </div>
    <button id="addWordPair">+ Add Pair</button>
    <br/><br/>
    <button id="saveWordMatch">Save Word Match</button>
    <button id="cancelWordMatch">Cancel</button>
  </div>
</div>

<script type="module" src="/static/js/quiz_editor_main.js"></script>

{% endblock %}
